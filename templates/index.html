<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>éƒ¨æ´»æ¨è–¦AI</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
        .ai-response { white-space: pre-wrap; background-color: #f0f0f0; padding: 15px; border-radius: 5px; margin-top: 20px; }
        .ban-message { color: red; font-weight: bold; margin-top: 15px; }
        #question-form { display: flex; margin-top: 20px; }
        #question-form input[type="text"] { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px 0 0 5px; }
        #question-form button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 0 5px 5px 0; cursor: pointer; }
        
        #loading-message {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd; 
            color: #856404; 
            border: 1px solid #ffeeba;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            display: none; 
        }
        
        /* ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #question-form[disabled] input, #question-form[disabled] button {
            cursor: not-allowed;
            opacity: 0.6;
        }
    </style>
</head>
<body>

    <h1>æ—©ç¨²ç”°ä¸­å­¦ éƒ¨æ´»æ¨è–¦AIï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼‰</h1>
    
    <div class="ai-response">
        {{ response }}
    </div>

    <div id="loading-message">
        AIãŒè€ƒãˆä¸­... å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ ğŸ¤–
    </div>

    <form id="question-form" method="POST" action="/" novalidate>
        <input type="text" name="question" id="question-input" placeholder="éƒ¨æ´»ã®èˆˆå‘³ã‚’è³ªå•ã—ã¦ãã ã•ã„...">
        <button type="button" id="submit-button">è³ªå•ã™ã‚‹</button> 
    </form>

    <script>
        console.log("--- JS DEBUG: ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ ---");
        
        const form = document.getElementById('question-form');
        const input = document.getElementById('question-input');
        const button = document.getElementById('submit-button');

        // ğŸš¨ ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®å‡¦ç† (submit ã‚¤ãƒ™ãƒ³ãƒˆã§ã¯ãªã click ã‚¤ãƒ™ãƒ³ãƒˆ)
        function handleClick(event) {
            console.log("--- JS DEBUG: ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆç™ºç« (handleClick) ---");
            
            if (button.disabled) {
                console.log("--- JS DEBUG: ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å®Ÿè¡Œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ ---");
                return;
            }

            const userQuestion = input.value.trim(); 

            if (!userQuestion) {
                console.log("--- JS DEBUG: å…¥åŠ›å€¤ãŒç©ºã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ ---");
                alert("è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            console.log("--- JS DEBUG: å…¥åŠ›ãƒã‚§ãƒƒã‚¯é€šéã€‚ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã—ã¾ã™ ---");
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ç„¡åŠ¹åŒ–
            document.getElementById('loading-message').style.display = 'block';
            input.disabled = true;
            button.disabled = true;
            form.setAttribute('disabled', 'disabled');

            // ã‚µãƒ¼ãƒãƒ¼ã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’å¼·åˆ¶é€ä¿¡
            form.submit();

            console.log("--- JS DEBUG: form.submit() å®Ÿè¡Œå®Œäº† ---");
        }
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        window.onload = function() {
            console.log("--- JS DEBUG: ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å®Œäº† ---");
            
            // ğŸš¨ ãƒœã‚¿ãƒ³ã«ç›´æ¥ 'click' ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šï¼
            if (button) {
                button.addEventListener('click', handleClick); // ğŸ‘ˆ ã“ã“ãŒ click
                console.log("--- JS DEBUG: ãƒœã‚¿ãƒ³ã« 'click' ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ ---");
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã®æœ‰åŠ¹åŒ–ï¼ˆå¿µã®ãŸã‚ï¼‰
            if (input) input.disabled = false;
            if (button) button.disabled = false;
            if (form) form.removeAttribute('disabled');
            const loadingMessage = document.getElementById('loading-message');
            if (loadingMessage) loadingMessage.style.display = 'none';
        }
        
        // æ—§é–¢æ•°åã¯ä¸è¦ã«ãªã‚Šã¾ã™ãŒã€å¿µã®ãŸã‚æ®‹ã—ã¦ãŠãã¾ã™
        window.checkBanAndSetCookie = handleClick;
    </script>

</body>
</html>
